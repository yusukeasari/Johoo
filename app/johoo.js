(function(){var f,H,I,T,U,V,t,W,J,X,Y,Z,u,aa,O,ba,ca,da,P,ea,l,p,c,fa,m,d,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,h=function(a,b){return function(){return a.apply(b,arguments)}},Ca={}.hasOwnProperty,k=function(a,b){function c(){this.constructor=a}for(var d in b)Ca.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};l=[0,4,8,16,32,64,128,256,256];p=[0,4,8,16,32,64,128,256,256];m=c=1;d=[[],[85*l[1],120*p[1]],[85*l[2],120*p[2]],[85*l[3],
120*p[3]],[85*l[4],120*p[4]],[85*l[5],120*p[5]],[85*l[6],120*p[6]],[85*l[7],120*p[7]],[85*l[8],120*p[8]]];fa=[];$(function(){var a,b,c;a=1;b=0;for(c=l.length;b<c;b++)fa.push(15*a),a++;return new V});var K=function(){this.setup=h(this.setup,this);this.initialize=h(this.initialize,this);return ia=K.__super__.constructor.apply(this,arguments)};k(K,Backbone.View);K.prototype.initialize=function(){var a;_.bindAll(this);this.uniBrowse=new f;a="css/johoo_"+f.device+".css";$("<link>").attr("href",a).attr("rel",
"stylesheet").load().appendTo($("head"));return this.setup()};K.prototype.setup=function(){var a=this;this.smodel=new X;this.shadow=new u;this.smallMap=new aa("#SmallMap","swfData/map.jpg");this.pyramid=new J;this.popup=new W;this.searchPanel=new Y;this.controlPanel=new I;this.marker=new U;this.pyramid.bind("openPopupFromPoint",function(b){a.popup.openPopupFromPoint(b);a.marker.setResult(b);return a.marker.render()});this.pyramid.bind("marker",function(){return a.marker.render()});this.searchPanel.bind("startSearch",
function(){return a.marker.clear()});this.searchPanel.bind("onclicktimeline",function(b){a.searchPanel.hide();a.smallMap.show();J.show();I.show();c=5;m=4;a.marker.setResult(b);return a.pyramid.moveToNum(b)});this.searchPanel.bind("backtomain",function(){a.searchPanel.hide();a.smallMap.show();J.show();return I.show()});this.pyramid.bind("moving",function(b){return a.smallMap.setCoords(b)});this.controlPanel.bind("change",function(b){return a.pyramid.update(b)});this.controlPanel.bind("onclickhomebutton",
function(){c=1;m=2;a.pyramid.update();a.pyramid.pyramidSetPositionToCenter();return setTimeout(function(){return a.pyramid.update()},100)});return this.controlPanel.bind("showSearchPanel",function(){a.searchPanel.show();a.smallMap.hide();J.hide();return I.hide()})};V=K;var r=function(){this.setCoords=h(this.setCoords,this);this.setup=h(this.setup,this);this.initialize=h(this.initialize,this);return ja=r.__super__.constructor.apply(this,arguments)};k(r,Backbone.View);r.prototype.el="";r.prototype.cursor=
"#smallMapCursor";r.prototype.image="#smallMapImage";r.prototype.m=4;r.prototype.dm=1;r.prototype.initialize=function(a,b){this.el=a;$(window).bind("orientationchange resize",this.setup);this.dm="smartphone"===f.device?1:2;this.m/=this.dm;$(this.el).css({overflow:"hidden","background-image":"url('"+b+"')","background-repeat":"no-repeat","background-size":d[1][0]/this.m+" "+d[1][1]/this.m});$("<div>").attr("id","smallMapCursor").appendTo($(this.el));return this.setup()};r.prototype.setup=function(){this.defaultRatio=
[this.m/d[1][0],this.m/d[1][1]];$(this.cursor).css({width:f.width/this.m,position:"relative",height:f.height/this.m,border:"solid 1px #FF0000",zIndex:40,left:20,top:50});$(this.el).css({left:f.width-d[1][0]/this.m-10,top:f.height-d[1][1]/this.m-10,width:d[1][0]/this.m,height:d[1][1]/this.m});return this.setCoords([f.width/2-d[c][0]/2,f.height/2-d[c][1]/2])};r.prototype.setCoords=function(a){return $(this.cursor).css({left:-1*(a[0]/(this.m*(d[c][0]/d[1][0]))),top:-1*(a[1]/(this.m*(d[c][1]/d[1][1]))),
width:f.width/(this.m*(d[c][0]/d[1][0])),height:f.height/(this.m*(d[c][1]/d[1][1]))})};r.prototype.hide=function(){return $(this.el).hide()};r.prototype.show=function(){return $(this.el).show()};aa=r;var E=function(){this.removeEvent=h(this.removeEvent,this);this.setEvent=h(this.setEvent,this);return ua=E.__super__.constructor.apply(this,arguments)};k(E,Backbone.Model);E.prototype.setEvent=function(a,b){var c=this;return this.bind(b,function(a){return c.cEvent(b,a)})};E.prototype.removeEvent=function(a){return this.unbind(a)};
E.prototype.cEvent=function(a,b){return this.trigger(""+a+"R",b)};X=E;var j=function(){this.clear=h(this.clear,this);this.hide=h(this.hide,this);this.show=h(this.show,this);this.render=h(this.render,this);this.error=h(this.error,this);this.onTapSubmitButton=h(this.onTapSubmitButton,this);this.loading=h(this.loading,this);this.bottom=h(this.bottom,this);return va=j.__super__.constructor.apply(this,arguments)};k(j,Backbone.View);j.prototype.el="#SearchPanel";j.prototype.searchQuery="";j.prototype.noMoreResult=
!1;j.timeline="";j.prototype.initialize=function(){var a=this;_.bindAll(this);this.timeline=new da;this.timeline.bind("add",this.appendTimeline);this.timeline.bind("onclicktimeline",this.onclicktimeline);this.searchQuery=new Z;this.execSearched=this.loadingStatus=!1;return $(this.el).load("searchPanel.html",null,function(b,c){if("success"!==c)return alert("ERROR:\u691c\u7d22\u30d1\u30cd\u30eb\u304c\u8aad\u307f\u8fbc\u3081\u307e\u305b\u3093");$(j.el).html(b);$("#backToMainButton").bind("click",a.onBackToMain);
return a.setup()})};j.prototype.onBackToMain=function(){return this.trigger("backtomain")};j.prototype.onclicktimeline=function(a){this.clear();return this.trigger("onclicktimeline",a)};j.prototype.appendTimeline=function(a){a=new ea({model:a});$("#searchResult").append(a.render().el);$(".tlTitle").css({width:f.width-80-10});return $(".tlMsg").css({width:f.width-80-10})};j.prototype.setup=function(){var a,b=this;$("#searchSubmitButton").bind("click",this.onTapSubmitButton);a=[];$("span.delig").each(function(){return a.push(new T($(this)))});
$("input[type=text]").each(function(a,c){return $(c).bind("keyup",function(a){if(13===a.keyCode)return b.onTapSubmitButton(),$(c).blur()})});return $(this.el).bind("bottom",this.bottom)};j.prototype.bottom=function(){var a=this;return setTimeout(function(){return a.sendQuery()},1500)};j.prototype.loading=function(a){var b=this;a?($("#loadingAnimation").html(""),$("#loadingAnimation").append('<img src="img/loadingAnimation.gif">'),$("#loadingAnimation").height(48)):($("#loadingAnimation").html(""),
!0!==this.noMoreResult&&($("#loadingAnimation").append('<span style="font-size:24px;margin:auto;vertical-align: middle;">\u30bf\u30c3\u30d7\u3057\u3066\u7d9a\u304d\u3092\u898b\u308b</span>'),$("#loadingAnimation").height(48),$("#loadingAnimation").bind("click",function(){b.loading(!0);$(b.el).trigger("bottom");return $("#loadingAnimation").unbind()})));return this.loadingStatus=a};j.prototype.onTapSubmitButton=function(){$("#searchResultError").html("");this.noMoreResult=!1;this.execSearched=!0;this.clear();
this.searchQuery.resetPageCount();this.sendQuery();return this.trigger("startSearch")};j.prototype.sendQuery=function(){var a,b=this;a="";this.searchQuery.unbind();this.searchQuery.bind("return",function(a){return b.render(a)});this.searchQuery.bind("error",function(){return b.error});void 0!==$("#SearchPanelInnerContents #id").val()&&(a+="id="+$("#SearchPanelInnerContents #id").val()+"&");void 0!==$("#SearchPanelInnerContents #b1").val()&&(a+="b1="+$("#SearchPanelInnerContents #b1").val()+"&");void 0!==
$("#SearchPanelInnerContents #b2").val()&&(a+="b2="+$("#SearchPanelInnerContents #b2").val()+"&");""!==a&&a.slice(0,-1);return this.searchQuery.sendQuery(a)};j.prototype.error=function(a){this.noMoreResult=!0;return $("#searchResultError").html(a)};j.prototype.render=function(a){var b,c,d,e;b=a[1][0].ERROR;c=a[1][1].TOTAL;a=a[0];switch(b){case "TOOMUCHRESULT":this.error("<br />\u691c\u7d22\u7d50\u679c\u304c100\u4ef6\u3092\u8d85\u3048\u307e\u3057\u305f\u3002<br />\u6761\u4ef6\u3092\u6307\u5b9a\u3057\u306a\u304a\u3057\u3066\u304f\u3060\u3055\u3044\u3002");
break;case "NOTFOUND":this.error("<br />\u691c\u7d22\u306b\u30d2\u30c3\u30c8\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002");break;case "NOWORD":this.error("<br />\u691c\u7d22\u6761\u4ef6\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002");break;default:if($("#searchResultError").html(c+"\u4ef6\u30d2\u30c3\u30c8\u3057\u307e\u3057\u305f\u3002"),10>a.length&&(this.noMoreResult=!0),""!==a){d=0;for(e=a.length;d<e;d++)b=a[d],c=new P,c.set({data:b}),this.timeline.add(c)}else alert("\u300c"+
value+"\u300d\u3067\u306f\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}return this.loading(!1)};j.prototype.show=function(){this.clear();u.show();$(this.el).show();$("input[type=tel]").each(function(){console.log(this);return $(this).focus()});$("#loadingAnimation").show();return $("#loadingAnimation").height(0)};j.prototype.hide=function(){this.loadingStatus=this.execSearched=!1;$("#loadingAnimation").hide();$("#loadingAnimation").html("");$("#loadingAnimation").height(0);
$("#searchResultError").html("");u.hide();return $(this.el).hide()};j.prototype.clear=function(){this.execSearched=!1;$("#loadingAnimation").html("");return this.timeline.clear()};Y=j;var F=function(){return wa=F.__super__.constructor.apply(this,arguments)};k(F,Backbone.View);F.prototype.el="";F.prototype.button="";F.prototype.initialize=function(a){var b=this;this.el=a;$("<span>").attr("id",this.el.children("input").attr("id")+"DelButton").appendTo(this.el);$("#"+this.el.children("input").attr("id")+
"DelButton").css({position:"relative",height:"22px",width:"22px",top:"2px",right:"25px","background-image":"url(img/delval.png)",cursor:"pointer",display:"inline-block",backgroundRepeat:"no-repeat",backgroundPosition:"center"});this.el.children("input").bind("keyup",function(){return""===b.el.children("input").val()?$("#"+b.el.children("input").attr("id")+"DelButton").css({opacity:0}):$("#"+b.el.children("input").attr("id")+"DelButton").css({opacity:1})});$("#"+this.el.children("input").attr("id")+
"DelButton").bind("click",function(){b.el.children("input").val("");$("#"+b.el.children("input").attr("id")+"DelButton").css({opacity:0});return $("#"+b.el.children("input").attr("id")+"DelButton").focus()});return $("#"+this.el.children("input").attr("id")+"DelButton").css({opacity:0})};T=F;var L=function(){return xa=L.__super__.constructor.apply(this,arguments)};k(L,Backbone.Collection);L.prototype.model=P;L.prototype.clear=function(){return this.each(function(a){return a.clear()})};da=L;var G=
function(){return ya=G.__super__.constructor.apply(this,arguments)};k(G,Backbone.Model);G.prototype.defaults={data:""};G.prototype.initialize=function(){return this.bind("onclicktimeline",this.onclicktimeline)};G.prototype.clear=function(){this.unbind;this.destroy;return this.view.unrender()};P=G;var w=function(){this.onclicks=h(this.onclicks,this);this.unrender=h(this.unrender,this);this.render=h(this.render,this);return za=w.__super__.constructor.apply(this,arguments)};k(w,Backbone.View);w.prototype.tagName=
"div";w.prototype.data="";w.prototype.events={click:"onclicks"};w.prototype.initialize=function(){_.bindAll(this);return this.model.view=this};w.prototype.render=function(){var a,b;this.data=a=this.model.get("data");b=$(this.el).attr("class","timelineChild").attr("id","timelineChild"+a.id);$("<img />").attr("class","tlImg").attr("width",80).attr("src","swfData/blockimg/"+a.img+".jpg").load().appendTo(b);$("<div>").attr("class","tlTitle").html(a.b1).appendTo(b);$("<br />").appendTo(b);$("<div>").attr("class",
"tlMsg").html(a.b2+("("+a.id+")")).appendTo(b);$("<br />").attr("class","timelineBR").appendTo(b);return this};w.prototype.unrender=function(){$(this.el).remove();return $(this.el).unbind()};w.prototype.onclicks=function(){return this.model.trigger("onclicktimeline",this.data.num)};ea=w;var y=function(){this.nextPage=h(this.nextPage,this);this.resetPageCount=h(this.resetPageCount,this);this.queryResult=h(this.queryResult,this);this.sendQuery=h(this.sendQuery,this);return Aa=y.__super__.constructor.apply(this,
arguments)};k(y,Backbone.View);y.prototype.page=1;y.prototype.linePerPage=30;y.prototype.sendQuery=function(a){var b=this;return $.ajax("swfData/search.php",{type:"GET",data:a+(""!==a?"&page="+this.page:"page="+this.page),dataType:"json",error:function(){return b.trigger("error")},success:function(a){b.nextPage();return b.queryResult(a)}})};y.prototype.queryResult=function(a){return this.trigger("return",a)};y.prototype.resetPageCount=function(){return this.page=1};y.prototype.nextPage=function(){return this.page++};
Z=y;var e=function(){return Ba=e.__super__.constructor.apply(this,arguments)};k(e,Backbone.View);e.device="";e.os="";e.width=0;e.height=0;e.orient=0;e.prototype.initialize=function(){_.bindAll(this);$(window).bind("orientationchange resize",this.setup);return this.setup()};e.prototype.setup=function(){navigator.userAgent.match(/iPhone/i)?(e.device="smartphone",e.os="ios",e.version="",e.width=90!==Math.abs(window.orientation)?screen.width:screen.height,e.height=90!==Math.abs(window.orientation)?screen.height-
64:screen.width-52):navigator.userAgent.match(/iPad/i)?(e.device="tablet",e.os="ios",e.version="",e.width=90!==Math.abs(window.orientation)?screen.width:screen.height,e.height=90!==Math.abs(window.orientation)?screen.height-96:screen.width-96):navigator.userAgent.match(navigator.userAgent.match(/Mobile/i))?(e.device="smartphone",e.os="android",e.version="",e.width=320,e.height=455):navigator.userAgent.match(/Android/i)?(e.device="tablet",e.os="android",e.version="",e.width=90!==Math.abs(window.orientation)?
600:960,e.height=90!==Math.abs(window.orientation)?780:430):(e.device="pc",e.width=$(window).width(),e.height=$(window).height());$("#Pyramid").width(e.width);$("#Pyramid").height(e.height);return this.hideAddressBar()};e.prototype.hideAddressBar=function(){if("ios"===e.getOS())return setTimeout(scrollTo,100,0,1);if("android"===e.getOS())return window.scrollTo(0,1)};e.getDevice=function(){return e.device};e.getOS=function(){return e.os};f=e;var B=function(){},Q,R,N,ga,S;Q={};S="Boolean Number String Function Array Date RegExp Undefined Null".split(" ");
N=0;for(ga=S.length;N<ga;N++)R=S[N],Q["[object "+R+"]"]=R.toLowerCase();B.type=function(a){a=Object.prototype.toString.call(a);return Q[a]||"object"};B.getDiagonal=function(a,b){return 0<a&&0<b?Math.sqrt(Math.pow(a,2)+Math.pow(b,2)):!1};var g=function(){return ka=g.__super__.constructor.apply(this,arguments)};k(g,Backbone.View);g.outerel="#Pyramid";g.prototype.el="#Tiles";g.prototype.searchHit="";g.prototype.initialize=function(){_.bindAll(this);"pc"!==f.device?($(this.el).bind("touchstart",this.onMouseDown),
$(this.el).bind("touchend",this.onMouseUp),$(this.el).bind("touchmove",this.onMouseMove),$(this.el).bind("gesturestart",this.onGestureStart),$(this.el).bind("gesturechange",this.onGestureMove),$(this.el).bind("gestureend",this.onGestureEnd)):($(this.el).bind("mousedown",this.onMouseDown),$(this.el).bind("mouseup",this.onMouseUp),$(this.el).bind("mousemove",this.onMouseMove));$(this.el).flickable();this.dragging=!1;this.tiles=new ca;this.tiles.bind("add",this.appendTile);$(this.el).css({cursor:"-moz-grab"});
$(this.el).css({"background-image":"url('swfData/bg.jpg')","background-size":"contain"});this.update();return this.pyramidSetPositionToCenter()};g.show=function(){return $(this.outerel).show()};g.hide=function(){return $(this.outerel).hide()};g.prototype.onMouseDown=function(a){var b;b=t.getPoint(a);t.lock(a);if(!1===t.isLock())return $(this.el).css({transform:"scale(1)"}),a.preventDefault(),this.dragging=!0,"array"!==B.type(b[0])?($(this.el).css({cursor:"-moz-grab"}),this.dragStartX=b[0],this.dragStartY=
b[1]):($(this.el).css({cursor:"-moz-grab"}),this.dragStartX=b[0][0]/2+b[1][0]/2,this.dragStartY=b[0][1]/2+b[1][1]/2),this.dragStartLeft=$(this.el).position().left,this.dragStartTop=$(this.el).position().top,this.dragStartPyramidX=this.getPyramidPos()[0],this.dragStartPyramidY=this.getPyramidPos()[1]};g.prototype.onMouseUp=function(a){var b,d;b=t.getPoint(a);if(void 0!==b&&!1===t.isLock())if($(this.el).css({transform:"scale(1)"}),a.preventDefault(),this.dragging=!1,$(this.el).css({cursor:""}),a="array"!==
B.type(b[0])?b[0]:b[0][0],d="array"!==B.type(b[1])?b[1]:b[0][1],this.isSingleTap(this.dragStartX,a)&&this.isSingleTap(this.dragStartY,d)){if(!u.isShow()&&3<c)return this.trigger("openPopupFromPoint",this.getNumFromPoint([b[0],b[1]]))}else if(this.isSingleTap(this.dragStartX,a)&&this.isSingleTap(this.dragStartY,d)&&this.isOnTiles([b[0][0],b[0][1]])){if(!u.isShow()&&3<c)return this.trigger("openPopupFromPoint",this.getNumFromPoint([b[0][0],b[0][1]]))}else return this.update()};g.prototype.onMouseMove=
function(a){var b;b=t.getPoint(a);if(void 0!==b&&!1===t.isLock()){a.preventDefault();if("number"===B.type(b[0])&&!0===this.dragging)return $(this.el).css({left:this.dragStartPyramidX+(this.getMousePos(a)[0]-this.dragStartX),top:this.dragStartPyramidY+(this.getMousePos(a)[1]-this.dragStartY)}),this.trigger("moving",[this.dragStartPyramidX+(this.getMousePos(a)[0]-this.dragStartX),this.dragStartPyramidY+(this.getMousePos(a)[1]-this.dragStartY)]);B.type(b[0])}};g.prototype.onGestureStart=function(){if(!1===
t.isLock())return $(this.el).css({transform:"scale(1)"})};g.prototype.onGestureMove=function(a){var b,v,e,f;if(!1===t.isLock())return e=this.dragStartX-this.dragStartLeft,f=this.dragStartY-this.dragStartTop,b=(d[c][0]-d[c][0]*a.originalEvent.scale)/2,b=b/a.originalEvent.scale+(d[c][0]-e),v=(d[c][1]-d[c][1]*a.originalEvent.scale)/2,v=v/a.originalEvent.scale+(d[c][1]-f),$(this.el).css({transform:"scale("+a.originalEvent.scale+") translate("+b+"px,"+v+"px)",left:-1*(d[c][0]-e)+this.dragStartLeft,top:-1*
(d[c][1]-f)+this.dragStartTop})};g.prototype.onGestureEnd=function(a){var b,v,e,f;if(!1===t.isLock()){$(this.el).css({left:this.dragStartLeft,top:this.dragStartTop,transform:"scale(1)"});b=0;if(1<a.originalEvent.scale){e=0;for(f=d.length;e<f;e++){v=d[e];if(!(d[c][0]*a.originalEvent.scale>v[0]&&""!==v[0])&&void 0!==v[0])break;b++}}else{e=0;for(f=d.length;e<f;e++){v=d[e];if(d[c][0]*a.originalEvent.scale<v[0])break;b++}}console.log("CONSOLE.LOG:",b);if(c!==b&&b<d.length)return m=c,c=b,this.update("pinchZoom");
if(b>d.length-1)return console.log("CONSOLE.LOG2:",b),m=c,c=d.length-2,this.update("pinchZoom")}};g.prototype.zoomIn=function(a){a=Math.floor(a/2);if(c<d.length-1)return m=c,c+a<d.length-1?c+=a:c=d.length-1};g.prototype.zoomOut=function(a){a=Math.floor(10*(a-1)/2);if(1<c)return m=c,1<c-a?c=1:c+=a};g.prototype.isOnTiles=function(a){return a[0]>=this.getPyramidPos()[0]&&a[1]>=this.getPyramidPos()[1]&&a[0]<=d[c][0]+this.getPyramidPos()[0]&&a[1]<=parseInt(d[c][1])+this.getPyramidPos()[1]?!0:!1};g.prototype.isSingleTap=
function(a,b){console.log(a,b);return a+3>b&&b>a-3?!0:!1};g.prototype.getNumFromPoint=function(a){var b;b=Math.floor((a[0]-this.getPyramidPos()[0])/l[c]);a=Math.round((a[1]-this.getPyramidPos()[1]+l[c]/2)/p[c]);b++;return 85*(0===a||1===a?0:a-1)+b};g.prototype.checkActiveTile=function(){var a,b,e,g;e=0<this.getPyramidPos()[0]&&0<f.width-Math.abs(this.getPyramidPos()[0])?0:Math.abs(this.getPyramidPos()[0]);g=0<this.getPyramidPos()[1]&&0<f.height-Math.abs(this.getPyramidPos()[1])?0:Math.abs(this.getPyramidPos()[1]);
a=this.getPyramidPos()[0]+d[c][0]>$("#Pyramid").width()?$("#Pyramid").width()-this.getPyramidPos()[0]:d[c][0];b=this.getPyramidPos()[1]+d[c][1]>$("#Pyramid").height()?$("#Pyramid").height()-this.getPyramidPos()[1]:d[c][1];0>=a&&(a=0);0>=b&&(b=0);return[Math.floor(e/256),Math.floor(g/256),Math.floor(a/256===Math.floor(d[c][0]/256))?Math.floor(a/256)-1:Math.floor(a/256),Math.floor(b/256===Math.floor(d[c][1]/256))?Math.floor(b/256)-1:Math.floor(b/256)]};g.prototype.render=function(a){var b,d,e;d=a[0];
e=a[1];for(this.tiles.removeAllTiles();e<=a[3];){for(;d<=a[2];)this.tiles.isSameTile(c,d,e)||(b=new O,b.set({x:d,y:e,z:c,display:!0}),this.tiles.add(b)),d++;e++;d=a[0]}return this.trigger("marker")};g.prototype.update=function(a){switch(a){case "zoomIn":this.moveToZoomInPos();break;case "zoomOut":this.moveToZoomOutPos();break;case "pinchZoom":this.moveToPinchZoomPos()}$(this.el).width(d[c][0]);$(this.el).height(d[c][1]);return this.render(this.checkActiveTile())};g.prototype.moveToNum=function(a){var b,
d=this;b=-1*a%85*l[c];a=-1*Math.floor(a/85)*l[c];$(this.el).css({left:f.width/2+b+l[c]/2,top:f.height/2+a-p[c]/2});setTimeout(function(){return d.update("")},500);return this.trigger("moving",[f.width/2+b+l[c]/2,f.height/2+a-p[c]/2])};g.prototype.moveToPinchZoomPos=function(){console.log("POS:",this.dragStartTop,(this.dragStartY-this.dragStartTop)*(c-m),this.dragStartTop,this.dragStartY-this.dragStartTop,Math.pow(2,c-m));if(void 0!==this.dragStartTop&&void 0!==this.dragStartLeft)return $(this.el).css({left:this.dragStartLeft-
(this.dragStartX-this.dragStartLeft)*(Math.pow(2,c-m)-1),top:this.dragStartTop-(this.dragStartY-this.dragStartTop)*(Math.pow(2,c-m)-1)}),this.trigger("moving",[$(this.el).position().left,$(this.el).position().top])};g.prototype.moveToZoomInPos=function(){var a;a=this.convertToGrobalCenterPos($(this.el).position().left,$(this.el).position().top);a=c===d.length-1?this.convertToLocalCenterPos(a[0],a[1]):this.convertToLocalCenterPos(2*a[0],2*a[1]);$(this.el).css({left:a[0],top:a[1]});return this.trigger("moving",
[a[0],a[1]])};g.prototype.moveToZoomOutPos=function(){var a;a=this.convertToGrobalCenterPos($(this.el).position().left,$(this.el).position().top);a=8!==m?this.convertToLocalCenterPos(a[0]/2,a[1]/2):8===m?this.convertToLocalCenterPos(a[0],a[1]):this.convertToLocalCenterPos(a[0]/2,a[1]/2);$(this.el).css({left:a[0],top:a[1]});return this.trigger("moving",[a[0],a[1]])};g.prototype.convertToGrobalCenterPos=function(a,b){return[a+d[m][0]/2-f.width/2,b+d[m][1]/2-f.height/2]};g.prototype.convertToLocalCenterPos=
function(a,b){return[a-d[c][0]/2+f.width/2,b-d[c][1]/2+f.height/2]};g.prototype.appendTile=function(a){a=new ba({model:a});return $(this.el).append(a.render().el)};g.prototype.pyramidSetPositionToCenter=function(){$(this.el).css({left:f.width/2-d[c][0]/2,top:f.height/2-d[c][1]/2});return this.trigger("moving",[f.width/2-d[c][0]/2,f.height/2-d[c][1]/2])};g.prototype.getMousePos=function(a){a=t.getPoint(a);return[a[0],a[1]]};g.prototype.getPyramidPos=function(){return[$(this.el).position().left,$(this.el).position().top]};
J=g;var z=function(){return la=z.__super__.constructor.apply(this,arguments)};k(z,Backbone.View);z.prototype.result="";z.prototype.initialize=function(){};z.prototype.clear=function(){this.result="";return $("#Marker").remove()};z.prototype.setResult=function(a){return this.result=a};z.prototype.render=function(){var a,b,d,e=this;if(""!==this.result)return $("#Marker").remove(),a=(this.result%85-1)*l[c],b=Math.floor(this.result/85)*p[c],0>a&&(a=0),$("<div />").attr("id","Marker").appendTo($("#Tiles")),
d=1>Math.floor(c/2)?1:Math.floor(c/2),$("#Marker").css({zIndex:3E3,width:l[c]-2*d,height:p[c]-2*d,left:a,top:b-2,border:"solid "+d+"px #FF0000"}),setTimeout(function(){return e.swap()},1E3)};z.prototype.swap=function(){return $("#Marker").css({zIndex:3E3})};U=z;var M=function(){return ma=M.__super__.constructor.apply(this,arguments)};k(M,Backbone.Model);M.prototype.defaults={x:0,y:0,z:0,display:!1};M.prototype.clear=function(){this.destroy;return this.view.unrender()};O=M;var C=function(){this.unrender=
h(this.unrender,this);this.render=h(this.render,this);return na=C.__super__.constructor.apply(this,arguments)};k(C,Backbone.View);C.prototype.tagName="img";C.prototype.initialize=function(){_.bindAll(this);return this.model.view=this};C.prototype.render=function(){var a,b,c,d;b=this.model.get("x");c=this.model.get("y");d=this.model.get("z");a="swfData/web/"+(""+d+"/"+c+"/")+"z"+d+"x"+b+"y"+c+".jpg";$(this.el).attr({id:"z"+d+"x"+b+"y"+c,src:a}).css({position:"absolute",left:256*b,top:256*c}).load();
return this};C.prototype.unrender=function(){return $(this.el).remove()};ba=C;var x=function(){return oa=x.__super__.constructor.apply(this,arguments)};k(x,Backbone.Collection);x.prototype.model=O;x.prototype.initialize=function(){return _.bindAll(this)};x.prototype.isSameTile=function(a,b,c){var d,e,f,g;d=[];this.each(function(a){return d.push(a)});f=0;for(g=d.length;f<g;f++)e=d[f],e=""+e.get("z")+" "+e.get("x")+" "+e.get("y")===""+a+" "+b+" "+c?!0:!1;return e};x.prototype.getNowVisibleList=function(){var a;
a=[];this.each(function(b){return a.push(b)});return a};x.prototype.setRemove=function(){var a;a=[];return this.each(function(b){return a.push(b)})};x.prototype.removeCheckedTiles=function(){var a,b,c,d;d=[];b=0;for(c=data.length;b<c;b++)a=data[b],a.get("display"!==!0)?d.push(a.clear()):d.push(void 0);return d};x.prototype.removeAllTiles=function(){return this.each(function(a){return a.clear()})};ca=x;var s=function(){return pa=s.__super__.constructor.apply(this,arguments)};k(s,Backbone.View);s.el=
"#ControlPanel";s.prototype.initialize=function(){_.bindAll(this);(new H("#ZoomInButton")).bind("change",this.zoomIn);(new H("#ZoomOutButton")).bind("change",this.zoomOut);(new H("#SearchPanelButton")).bind("change",this.showSearchPanel);return(new H("#HomeButton")).bind("change",this.onclickhomebutton)};s.prototype.zoomIn=function(){if(c<d.length-1)return m=c,c++,this.trigger("change","zoomIn")};s.prototype.zoomOut=function(){if(1<c)return m=c,c--,this.trigger("change","zoomOut")};s.prototype.showSearchPanel=
function(){return this.trigger("showSearchPanel")};s.prototype.onclickhomebutton=function(){return this.trigger("onclickhomebutton")};s.show=function(){return $(s.el).show()};s.hide=function(){return $(s.el).hide()};I=s;var ha=function(){return qa=ha.__super__.constructor.apply(this,arguments)};k(ha,Backbone.Model);var D=function(){return ra=D.__super__.constructor.apply(this,arguments)};k(D,Backbone.View);D.prototype.el="";D.prototype.initialize=function(a){_.bindAll(this);this.el=a;$(this.el).unbind();
return"pc"!==f.device?$(this.el).bind("touchend",this.onMouseUp):$(this.el).bind("mouseup",this.onMouseUp)};D.prototype.onMouseUp=function(a){a.preventDefault();return this.trigger("change")};D.prototype.destroy=function(){$(this.el).unbind();return $(this.el).remove()};H=D;var A=function(){};A.locked=!1;A.plock=0;A.lock=function(a){this.locked=2<a.originalEvent.touches.length&&3>this.plock?!0:!1;return this.plock=a.originalEvent.touches.length};A.isLock=function(){return this.locked};A.getPoint=
function(a){var b,c,d,e,f,g,h,j,k;if(A.isTouch()){if(1===a.originalEvent.touches.length)return[a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY];if(1<a.originalEvent.touches.length){b=[];c=!1;k=a.originalEvent.touches;h=0;for(j=k.length;h<j;h++)a=k[h],a.pageX>d&&!0===c?d=a.pageX:!1===c&&(d=a.pageX),a.pageX<f&&!0===c?f=a.pageX:!1===c&&(f=a.pageX),a.pageY>e&&!0===c?e=a.pageY:!1===c&&(e=a.pageY),a.pageY<g&&!0===c?g=a.pageY:!1===c&&(g=a.pageY),c=!0;b.push([d,e]);b.push([f,g]);return b}return[a.originalEvent.changedTouches[0].pageX,
a.originalEvent.changedTouches[0].pageY]}return[a.pageX,a.pageY]};A.isTouch=function(){return"ontouchstart"in window};t=A;var n=function(){return sa=n.__super__.constructor.apply(this,arguments)};k(n,Backbone.View);n.el="#Shadow";n.prototype.initialize=function(){return $(window).bind("load resize orientationchange",this.resize)};n.show=function(){n.setSize();return $(n.el).show()};n.hide=function(){n.setSize();return $(n.el).hide()};n.prototype.resize=function(){return n.setSize()};n.setSize=function(){$(this.el).width(f.width);
return $(this.el).height(f.height)};n.isShow=function(){return"none"===$(n.el).css("display")?!1:!0};u=n;var q=function(){this.closeButtonAction=h(this.closeButtonAction,this);this.render=h(this.render,this);return ta=q.__super__.constructor.apply(this,arguments)};k(q,Backbone.View);q.prototype.el="#Popup";q.prototype.initialize=function(){_.bindAll(this);return $(window).bind("resize orientationchange",this.resize)};q.prototype.openPopupFromPoint=function(a){var b=this;this.show();return $.getJSON("swfData/search.php",
{n:a},function(a,c){return c&&null!==a?b.render(a[0]):b.hide()})};q.prototype.clear=function(){if(""!==$(this.el).html())return $("#closeButton").unbind(),$(this.el).html("")};q.prototype.closePopup=function(a){void 0!==a&&a.preventDefault();this.clear();return this.hide()};q.prototype.render=function(a){var b=this;return $("<img />").css("margin-top",5).attr("src","swfData/blockimg/"+a.img+".jpg").load(function(){$("<div />").attr("id","popupOuterText").appendTo($(b.el));$("#popupOuterText").css({width:"80%",
margin:"auto"});$("<p>").attr("class","popupB1Style").text(a.b1).appendTo($(b.el));$("<p>").attr("class","popupB2Style").text(a.b2+("("+a.id+")")).appendTo($(b.el));$("<input>").attr("id","closeButton").attr("type","button").attr("value","\u9589\u3058\u308b").appendTo($(b.el));return b.closeButtonAction()}).error(function(){return b.closePopup()}).appendTo($(this.el))};q.prototype.closeButtonAction=function(){var a=this;return"pc"!==f.device?$("#closeButton").bind("touchend",function(b){b.preventDefault();
return a.closePopup(b)}):$("#closeButton").bind("mouseup",function(b){b.preventDefault();return a.closePopup(b)})};q.prototype.show=function(){u.setSize();$(this.el).show();return u.show()};q.prototype.hide=function(){u.setSize();$(this.el).hide();return u.hide()};q.prototype.resize=function(){return u.setSize()};q.setSize=function(){$(this.el).width(f.width);return $(this.el).height(f.height)};W=q}).call(this);